<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìš´ë™ KPR ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <!-- React 18 UMD + Babel (ê°œë°œìš©) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    .header { text-align:center; margin-bottom:30px; color:#fff; }
    .header h1 { font-size:2.5rem; margin-bottom:10px; text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    .header p { font-size:1.1rem; opacity:.9; }

    .nav-tabs { display:flex; background:#fff; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); overflow:hidden; flex-wrap:wrap; }
    .nav-tab { flex:1; padding:15px 10px; text-align:center; cursor:pointer; background:#fff; border:none; font-size:.9rem; font-weight:600; transition:all .3s ease; min-width:100px; }
    .nav-tab:hover { background:#f8f9fa; }
    .nav-tab.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }

    .content-area { background:#fff; border-radius:15px; padding:25px; box-shadow:0 8px 25px rgba(0,0,0,0.15); }

    .workout-sections { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:30px; }
    .workout-section { background:#f8f9fa; border-radius:12px; padding:20px; border-left:5px solid; }
    .workout-section.í•˜ì²´ { border-left-color:#e74c3c; }
    .workout-section.ë“± { border-left-color:#3498db; }
    .workout-section.ê°€ìŠ´ { border-left-color:#2ecc71; }
    .workout-section.ì–´ê¹¨ { border-left-color:#f39c12; }
    .workout-section.íŒ” { border-left-color:#9b59b6; }
    .workout-section.ì½”ì–´ { border-left-color:#1abc9c; }

    .section-title { font-size:1.3rem; font-weight:bold; margin-bottom:15px; display:flex; align-items:center; gap:8px; }

    /* ë¼ì´ë¸ŒëŸ¬ë¦¬ìš© ìŠ¤íƒ€ì¼ */
    .exercise-item { background:#fff; padding:12px 15px; margin-bottom:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); transition:transform .2s ease; }
    .exercise-item:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    .exercise-name { font-weight:600; margin-bottom:5px; color:#2c3e50; }
    .exercise-stats { display:flex; gap:15px; font-size:.9rem; color:#7f8c8d; flex-wrap:wrap; }
    .stat { display:flex; align-items:center; gap:4px; }
    
    /* [ì‹ ê·œ] ìš´ë™ê¸°ë¡ íƒ­ì˜ ì‹¬í”Œí•œ ìš´ë™ ëª©ë¡ ìŠ¤íƒ€ì¼ */
    .simple-exercise-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e9ecef; }
    .exercise-name-simple { font-weight: 600; color: #2c3e50; }
    .last-record-info { font-size: 0.9rem; color: #6c757d; font-weight: 500; }

    .dashboard-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
    .stat-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; padding:20px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .stat-number { font-size:2rem; font-weight:bold; margin-bottom:5px; }
    .stat-label { font-size:.9rem; opacity:.9; }

    .chart-container { background:#fff; padding:20px; border-radius:12px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .chart-title { font-size:1.2rem; font-weight:600; margin-bottom:20px; text-align:center; color:#2c3e50; }

    .workout-form { background:#f8f9fa; padding:20px; border-radius:12px; margin-bottom:20px; }
    .form-group { margin-bottom:15px; }
    .form-label { display:block; margin-bottom:5px; font-weight:600; color:#2c3e50; }
    .form-input, .form-select { width:100%; padding:10px 12px; border:2px solid #e9ecef; border-radius:8px; font-size:1rem; transition:border-color .3s ease; }
    .form-input:focus, .form-select:focus { outline:none; border-color:#667eea; }
    .form-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; }

    .btn { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:all .3s ease; }
    .btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
    .btn-secondary { background:#6c757d; color:#fff; }
    .btn-success { background:#28a745; color:#fff; }
    .btn-danger { background:#dc3545; color:#fff; }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.2); }

    .timer-display { font-size:3rem; font-weight:bold; text-align:center; margin:20px 0; color:#2c3e50; }
    .timer-controls { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }

    .recent-workout { background:#f8f9fa; border-radius:8px; padding:15px; margin-bottom:10px; border-left:4px solid #667eea; }
    .workout-date { font-size:.9rem; color:#6c757d; margin-bottom:5px; }
    .workout-summary { display:flex; justify-content:space-between; align-items:center; }

    .progress-item { background:#fff; padding:15px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .progress-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .progress-bar { width:100%; height:8px; background:#e9ecef; border-radius:4px; overflow:hidden; }
    .progress-fill { height:100%; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); transition:width .3s ease; }

    /* ì„¸íŠ¸ ì…ë ¥ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .sets-container { background:#fff; border-radius:12px; padding:20px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .set-row { display:grid; grid-template-columns:auto 1fr 1fr auto; gap:15px; align-items:center; padding:10px; margin-bottom:10px; background:#f8f9fa; border-radius:8px; }
    .set-number { font-weight:600; color:#667eea; min-width:60px; }
    .set-input { padding:8px 12px; border:2px solid #e9ecef; border-radius:6px; font-size:1rem; }
    .set-input:focus { outline:none; border-color:#667eea; }
    .total-volume { text-align:center; padding:15px; background:#e8f4fd; border-radius:8px; margin-top:10px; font-weight:600; color:#0c5460; }
    .exercise-selection { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    
    /* [ì‹ ê·œ] PR í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .pr-display { text-align: center; padding: 10px; margin-bottom: 15px; background: #fef9c3; color: #713f12; border-radius: 8px; font-weight: 600; border: 1px solid #fde047; font-size: 0.9rem; }

    @media (max-width:768px) {
      .container { padding:10px; }
      .nav-tabs { flex-wrap:wrap; }
      .nav-tab { flex:none; min-width:80px; font-size:.8rem; padding:12px 8px; }
      .workout-sections { grid-template-columns:1fr; }
      .dashboard-stats { grid-template-columns:repeat(2,1fr); }
      .form-row { grid-template-columns:1fr; }
      .header h1 { font-size:2rem; }
      .set-row { grid-template-columns:auto 1fr 1fr; gap:10px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react,env">
    const { useState, useEffect, useRef } = React;

    /* ì´ˆê¸° ìš´ë™ ë°ì´í„° */
    const initialExercises = {
      'í•˜ì²´': [
        { name: 'ìŠ¤ì¿¼íŠ¸', weight: 70, reps: 10, sets: 3 },
        { name: 'ë ˆê·¸í”„ë ˆìŠ¤', weight: 115, reps: 15, sets: 3 },
        { name: 'ë ˆê·¸ìµìŠ¤í…ì…˜', weight: 50, reps: 12, sets: 3 },
        { name: 'ë ˆê·¸ì»¬', weight: 35, reps: 12, sets: 3 },
        { name: 'ìŠ¤í‹°í”„ë°ë“œ', weight: 14, reps: 12, sets: 3 }
      ],
      'ë“±': [
        { name: 'ë°”ë²¨ë¡œìš°', weight: 40, reps: 10, sets: 3 },
        { name: 'ë«í’€ë‹¤ìš´', weight: 40, reps: 12, sets: 3 },
        { name: 'íˆ¬ì•”ë¤ë²¨ë¡œìš°', weight: 14, reps: 12, sets: 3 },
        { name: 'ì›ì•”ë¤ë²¨ë¡œìš°', weight: 16, reps: 12, sets: 3 },
        { name: 'ì¼€ì´ë¸”ë¡œìš°', weight: 50, reps: 12, sets: 3 },
        { name: 'ì–´ì‹œìŠ¤íŠ¸í’€ì—…', weight: 90, reps: 12, sets: 3 }
      ],
      'ê°€ìŠ´': [
        { name: 'ë²¤ì¹˜í”„ë ˆìŠ¤', weight: 45, reps: 10, sets: 3 },
        { name: 'ë¤ë²¨ ë²¤ì¹˜í”„ë ˆìŠ¤', weight: 16, reps: 8, sets: 3 },
        { name: 'ì¸í´ë¼ì¸ë¤ë²¨í”„ë ˆìŠ¤', weight: 14, reps: 12, sets: 3 },
        { name: 'ì¸í´ë¼ì¸ìŠ¤ë¯¸ìŠ¤', weight: 30, reps: 10, sets: 3 },
        { name: 'ì¼€ì´ë¸” í¬ë¡œìŠ¤ì˜¤ë²„', weight: 20, reps: 12, sets: 3 },
        { name: 'í™ë± í”Œë¼ì´', weight: 25, reps: 12, sets: 3 }
      ],
      'ì–´ê¹¨': [
        { name: 'ì˜¤ë²„í—¤ë“œí”„ë ˆìŠ¤', weight: 25, reps: 11, sets: 3 },
        { name: 'í˜ì´ìŠ¤í’€', weight: 25, reps: 20, sets: 3 },
        { name: 'ì‚¬ì´ë“œ ë ˆí„°ëŸ´ ë ˆì´ì¦ˆ', weight: 5, reps: 12, sets: 3 },
        { name: 'ë²¤íŠ¸ ì˜¤ë²„ ë ˆì´ì¦ˆ', weight: 5, reps: 12, sets: 3 },
        { name: 'ë¦¬ì–´ ë¸íŠ¸ í”Œë¼ì´', weight: 15, reps: 12, sets: 3 }
      ],
      'íŒ”': [
        { name: 'ì¼€ì´ë¸”í‘¸ì‰¬ë‹¤ìš´', weight: 30, reps: 13, sets: 3 },
        { name: 'ë¤ë²¨ì»¬', weight: 8, reps: 10, sets: 3 }
      ],
      'ì½”ì–´': [
        { name: 'ë³µë¶€ì„œí‚·', weight: 0, reps: 30, sets: 3 }
      ]
    };

    /* ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ í›… */
    const useLocalStorage = (key, initialValue) => {
      const isBrowser = typeof window !== 'undefined' && typeof window.localStorage !== 'undefined';
      const [storedValue, setStoredValue] = useState(() => {
        if (!isBrowser) return initialValue;
        try {
          const item = window.localStorage.getItem(key);
          return item ? JSON.parse(item) : initialValue;
        } catch (error) {
          console.error('Error reading from localStorage:', error);
          return initialValue;
        }
      });

      const setValue = (value) => {
        try {
          const valueToStore = typeof value === 'function' ? value(storedValue) : value;
          setStoredValue(valueToStore);
          if (isBrowser) window.localStorage.setItem(key, JSON.stringify(valueToStore));
        } catch (error) {
          console.error('Error writing to localStorage:', error);
        }
      };
      return [storedValue, setValue];
    };

    /* íƒ€ì´ë¨¸ ì»´í¬ë„ŒíŠ¸ */
    const Timer = ({ isActive, time, onStart, onStop, onReset }) => {
      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
      };

      return (
        <div className="chart-container">
          <div className="chart-title">íœ´ì‹ íƒ€ì´ë¨¸</div>
          <div className="timer-display">{formatTime(time)}</div>
          <div className="timer-controls">
            <button className={`btn ${isActive ? 'btn-danger' : 'btn-success'}`} onClick={isActive ? onStop : onStart}>
              {isActive ? 'ì •ì§€' : 'ì‹œì‘'}
            </button>
            <button className="btn btn-secondary" onClick={onReset}>ë¦¬ì…‹</button>
          </div>
        </div>
      );
    };

    /* ìš´ë™ ê¸°ë¡ í¼ ì»´í¬ë„ŒíŠ¸ */
    const ExerciseForm = ({ exercises, onAddExercise, personalRecords }) => {
      const bodyParts = Object.keys(exercises);
      const [selectedBodyPart, setSelectedBodyPart] = useState(() => {
        try {
          const saved = localStorage.getItem('lastSelectedBodyPart');
          return saved && bodyParts.includes(saved) ? saved : bodyParts[0] || 'í•˜ì²´';
        } catch { return bodyParts[0] || 'í•˜ì²´'; }
      });
      const [selectedExercise, setSelectedExercise] = useState('');
      const [sets, setSets] = useState(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
      const [notes, setNotes] = useState('');
      const [currentPR, setCurrentPR] = useState(null); // [ì‹ ê·œ] í˜„ì¬ ì„ íƒëœ ìš´ë™ì˜ PR ìƒíƒœ

      useEffect(() => {
        try { localStorage.setItem('lastSelectedBodyPart', selectedBodyPart); } catch {}
      }, [selectedBodyPart]);

      useEffect(() => {
        setSelectedExercise('');
        resetSets();
      }, [selectedBodyPart]);

      const resetSets = () => {
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
        setNotes('');
        setCurrentPR(null); // ì„¸íŠ¸ ì´ˆê¸°í™” ì‹œ PR ì •ë³´ë„ ì´ˆê¸°í™”
      };

      // [ìˆ˜ì •] ìš´ë™ ì„ íƒ ì‹œ PR ì •ë³´ ì—…ë°ì´íŠ¸
      const handleExerciseChange = (e) => {
        const name = e.target.value;
        setSelectedExercise(name);
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' }))); // ì„¸íŠ¸ ì…ë ¥ì¹¸ ë¹„ìš°ê¸°
        setNotes('');

        if (name) {
          const pr = personalRecords[name];
          setCurrentPR(pr || null);
        } else {
          setCurrentPR(null);
        }
      };

      const updateSet = (index, field, value) => {
        const newSets = [...sets];
        newSets[index] = { ...newSets[index], [field]: value };
        setSets(newSets);
      };

      const calculateTotalVolume = () => sets.reduce((total, set) => (total + ((parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0))), 0);
      const getValidSets = () => sets.filter(set => (parseFloat(set.weight) || 0) > 0 && (parseInt(set.reps, 10) || 0) > 0);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!selectedBodyPart || !selectedExercise) {
          alert('ìš´ë™ ë¶€ìœ„ì™€ ìš´ë™ì„ ì„ íƒí•˜ì„¸ìš”.');
          return;
        }
        const validSets = getValidSets();
        if (validSets.length === 0) {
          alert('ìµœì†Œ 1ì„¸íŠ¸ì˜ ë¬´ê²Œì™€ ë°˜ë³µìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        validSets.forEach((set, index) => {
          const exerciseData = {
            id: Date.now() + index,
            name: selectedExercise,
            weight: parseFloat(set.weight),
            reps: parseInt(set.reps, 10),
            sets: 1,
            setNumber: index + 1,
            totalSets: validSets.length,
            notes: index === 0 ? notes : '',
            date: new Date().toISOString(),
            bodyPart: selectedBodyPart
          };
          onAddExercise(exerciseData);
        });

        const exerciseNameForAlert = selectedExercise;
        setSelectedExercise('');
        resetSets();
        alert(`${exerciseNameForAlert} ${validSets.length}ì„¸íŠ¸ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
      };

      const currentExerciseList = exercises[selectedBodyPart] || [];

      return (
        <div>
          <div className="exercise-selection">
            <div className="form-row">
              <div className="form-group">
                <label className="form-label">ë¶€ìœ„ ì„ íƒ</label>
                <select className="form-select" value={selectedBodyPart} onChange={(e) => setSelectedBodyPart(e.target.value)}>
                  {bodyParts.map((part) => <option key={part} value={part}>{part}</option>)}
                </select>
              </div>
              <div className="form-group">
                <label className="form-label">ìš´ë™ ì„ íƒ</label>
                <select className="form-select" value={selectedExercise} onChange={handleExerciseChange}>
                  <option value="">ìš´ë™ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  {currentExerciseList.map((exercise, index) => <option key={index} value={exercise.name}>{exercise.name}</option>)}
                </select>
              </div>
            </div>
          </div>

          {selectedExercise && (
            <div className="sets-container">
              <div className="chart-title">{selectedExercise} - ì„¸íŠ¸ë³„ ê¸°ë¡</div>
              
              {/* [ì‹ ê·œ] ê°œì¸ ìµœê³  ê¸°ë¡(PR) í‘œì‹œ */}
              {currentPR ? (
                <div className="pr-display">
                  ğŸ† ê°œì¸ ìµœê³ ê¸°ë¡ (PR): {currentPR.weight}kg x {currentPR.reps}íšŒ ({new Date(currentPR.date).toLocaleDateString('ko-KR')})
                </div>
              ) : (
                <div className="pr-display" style={{ background: '#f3f4f6', color: '#6b7280', border: '1px solid #e5e7eb' }}>
                  ì•„ì§ ì´ ìš´ë™ì˜ ê°œì¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
              )}

              {sets.map((set, index) => (
                <div key={index} className="set-row">
                  <div className="set-number">{index + 1}ì„¸íŠ¸</div>
                  <input type="number" className="set-input" placeholder="ë¬´ê²Œ (kg)" value={set.weight} onChange={(e) => updateSet(index, 'weight', e.target.value)} step="0.5" min="0" inputMode="decimal" />
                  <input type="number" className="set-input" placeholder="ë°˜ë³µìˆ˜" value={set.reps} onChange={(e) => updateSet(index, 'reps', e.target.value)} min="1" inputMode="numeric" />
                  <div style={{ fontSize: '.9rem', color: '#6c757d', minWidth: '80px' }}>
                    {(parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0)}kg
                  </div>
                </div>
              ))}
              <div className="total-volume">ì´ ë³¼ë¥¨: {calculateTotalVolume().toLocaleString()}kg ({getValidSets().length}ì„¸íŠ¸)</div>
              <div className="form-group" style={{ marginTop: '15px' }}>
                <label className="form-label">ë©”ëª¨</label>
                <input type="text" className="form-input" value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="ìš´ë™ì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
              </div>
              <button type="button" className="btn btn-primary" style={{ width: '100%', marginTop: '15px' }} onClick={handleSubmit} disabled={getValidSets().length === 0}>
                {selectedExercise} ìš´ë™ ì™„ë£Œ ({getValidSets().length}ì„¸íŠ¸)
              </button>
            </div>
          )}
        </div>
      );
    };
    
    /* ë¼ì´ë¸ŒëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸ */
    function Library({ bodyParts, exercises, setExercises }) {
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedBodyPart, setSelectedBodyPart] = useState('ì „ì²´');
      const [newExercise, setNewExercise] = useState({ name: '', bodyPart: 'í•˜ì²´', weight: '', reps: '', sets: '3' });
      const [isAddingExercise, setIsAddingExercise] = useState(false);

      const addNewExercise = () => {
        if (!newExercise.name.trim()) return;
        const exerciseData = {
          name: newExercise.name.trim(),
          weight: parseFloat(newExercise.weight) || 0,
          reps: parseInt(newExercise.reps, 10) || 12,
          sets: parseInt(newExercise.sets, 10) || 3
        };
        setExercises(prev => ({ ...prev, [newExercise.bodyPart]: [...(prev[newExercise.bodyPart] || []), exerciseData] }));
        setNewExercise({ name:'', bodyPart:'í•˜ì²´', weight:'', reps:'', sets:'3' });
        setIsAddingExercise(false);
      };

      const deleteExercise = (bodyPart, exerciseIndex) => {
        setExercises(prev => ({ ...prev, [bodyPart]: (prev[bodyPart] || []).filter((_, idx) => idx !== exerciseIndex) }));
      };

      const filteredExercises = () => {
        const result = [];
        Object.entries(exercises).forEach(([part, list]) => {
          if (selectedBodyPart === 'ì „ì²´' || selectedBodyPart === part) {
            list.forEach((ex, idx) => {
              if (ex.name.toLowerCase().includes(searchTerm.toLowerCase())) {
                result.push({ ...ex, bodyPart: part, index: idx });
              }
            });
          }
        });
        return result;
      };

      return (
        <div>
          <div className="workout-form">
            <div className="form-group"><label className="form-label">ê²€ìƒ‰</label><input type="text" className="form-input" placeholder="ìš´ë™ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} /></div>
            <div className="form-group"><label className="form-label">ë¶€ìœ„ í•„í„°</label><select className="form-select" value={selectedBodyPart} onChange={(e)=>setSelectedBodyPart(e.target.value)}><option value="ì „ì²´">ì „ì²´</option>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div>
            <button className="btn btn-primary" onClick={()=>setIsAddingExercise(!isAddingExercise)} style={{ width:'100%' }}>{isAddingExercise ? 'ì·¨ì†Œ' : 'ìƒˆ ìš´ë™ ì¶”ê°€'}</button>
          </div>
          {isAddingExercise && (<div className="workout-form"><div className="form-group"><label className="form-label">ìš´ë™ ì´ë¦„</label><input type="text" className="form-input" value={newExercise.name} onChange={(e)=>setNewExercise(prev=>({...prev, name:e.target.value}))} placeholder="ìš´ë™ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" /></div><div className="form-row"><div className="form-group"><label className="form-label">ë¶€ìœ„</label><select className="form-select" value={newExercise.bodyPart} onChange={(e)=>setNewExercise(prev=>({...prev, bodyPart:e.target.value}))}>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div><div className="form-group"><label className="form-label">ê¸°ë³¸ ë¬´ê²Œ</label><input type="number" className="form-input" value={newExercise.weight} onChange={(e)=>setNewExercise(prev=>({...prev, weight:e.target.value}))} step="0.5" inputMode="decimal" /></div><div className="form-group"><label className="form-label">ê¸°ë³¸ ë°˜ë³µìˆ˜</label><input type="number" className="form-input" value={newExercise.reps} onChange={(e)=>setNewExercise(prev=>({...prev, reps:e.target.value}))} inputMode="numeric" /></div></div><button className="btn btn-success" onClick={addNewExercise} style={{ width:'100%' }}>ìš´ë™ ì¶”ê°€í•˜ê¸°</button></div>)}
          <div className="chart-container"><div className="chart-title">ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬ ({filteredExercises().length}ê°œ)</div><div style={{ maxHeight:'400px', overflowY:'auto' }}>{filteredExercises().map((exercise, idx) => (<div key={`${exercise.bodyPart}-${exercise.name}-${idx}`} className="exercise-item"><div className="exercise-name">{exercise.name}<span style={{ background:'#e9ecef', color:'#6c757d', padding:'2px 8px', borderRadius:'12px', fontSize:'.8rem', marginLeft:'8px' }}>{exercise.bodyPart}</span></div><div className="exercise-stats"><div className="stat">âš–ï¸ {exercise.weight}kg</div><div className="stat">ğŸ”¢ {exercise.reps}íšŒ</div><div className="stat">ğŸ“Š {exercise.sets}ì„¸íŠ¸</div><button className="btn btn-danger" style={{ padding:'4px 8px', fontSize:'.8rem' }} onClick={()=>deleteExercise(exercise.bodyPart, exercise.index)}>ì‚­ì œ</button></div></div>))}</div></div>
        </div>
      );
    }

    /* ë©”ì¸ ì•± */
    const WorkoutKPRApp = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [exercises, setExercises] = useLocalStorage('exercises', initialExercises);
      const [workoutHistory, setWorkoutHistory] = useLocalStorage('workoutHistory', []);
      const [personalRecords, setPersonalRecords] = useLocalStorage('personalRecords', {});
      const [timerTime, setTimerTime] = useState(0);
      const [isTimerActive, setIsTimerActive] = useState(false);
      const timerRef = useRef(null);

      const bodyParts = Object.keys(exercises);

      useEffect(() => {
        if (isTimerActive) {
          if (timerRef.current) clearInterval(timerRef.current);
          timerRef.current = setInterval(() => setTimerTime(prev => prev + 1), 1000);
        } else if (timerRef.current) {
          clearInterval(timerRef.current);
          timerRef.current = null;
        }
        return () => { if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; } };
      }, [isTimerActive]);

      const calculateOneRM = (weight, reps) => {
        if (!Number.isFinite(weight) || !Number.isFinite(reps) || reps <= 0) return 0;
        if (reps === 1) return Math.round(weight);
        return Math.round(weight * (1 + reps / 30));
      };

      const addWorkoutRecord = (exerciseData) => {
        setWorkoutHistory(prev => [exerciseData, ...prev]);
        const exerciseName = exerciseData.name;
        const currentPR = personalRecords[exerciseName];
        const newOneRM = calculateOneRM(exerciseData.weight, exerciseData.reps);
        if (!currentPR || newOneRM > currentPR.oneRM) {
          setPersonalRecords(prev => ({ ...prev, [exerciseName]: { weight: exerciseData.weight, reps: exerciseData.reps, oneRM: newOneRM, date: exerciseData.date } }));
        }
      };

      const copyTodaysWorkoutToClipboard = () => {
        const now = new Date();
        const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const todaysWorkouts = workoutHistory.filter(w => new Date(w.date) >= startOfToday).reverse();
        if (todaysWorkouts.length === 0) {
            alert('ì˜¤ëŠ˜ ê¸°ë¡ëœ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        const groupedByExercise = todaysWorkouts.reduce((acc, workout) => {
            if (!acc[workout.name]) acc[workout.name] = [];
            acc[workout.name].push(workout);
            return acc;
        }, {});
        let clipboardText = `[${now.toLocaleDateString('ko-KR')} ìš´ë™ ê¸°ë¡]\n\n`;
        for (const exerciseName in groupedByExercise) {
            clipboardText += `ğŸ”¥ ${exerciseName}\n`;
            const sets = groupedByExercise[exerciseName];
            const mainNote = sets.find(s => s.notes)?.notes || '';
            sets.forEach(set => { clipboardText += `  - ${set.setNumber}ì„¸íŠ¸: ${set.weight}kg x ${set.reps}íšŒ\n`; });
            if (mainNote) clipboardText += `  ğŸ“ ë©”ëª¨: ${mainNote}\n`;
            clipboardText += '\n';
        }
        const textarea = document.createElement('textarea');
        textarea.value = clipboardText.trim();
        textarea.style.position = 'fixed';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            alert('ì˜¤ëŠ˜ì˜ ìš´ë™ ê¸°ë¡ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (err) {
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨: ', err);
        }
        document.body.removeChild(textarea);
      };

      const calculateStats = () => {
        const now = new Date();
        const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const sevenDaysAgo = new Date(now.getTime() - 7*24*60*60*1000);
        const thirtyDaysAgo = new Date(now.getTime() - 30*24*60*60*1000);
        const todayWorkouts = workoutHistory.filter(w => new Date(w.date) >= startOfToday).length;
        const weekWorkouts = workoutHistory.filter(w => new Date(w.date) >= sevenDaysAgo).length;
        const monthVolume = workoutHistory.filter(w => new Date(w.date) >= thirtyDaysAgo).reduce((t,w)=>t + (w.weight*w.reps*w.sets), 0);
        const totalPRs = Object.keys(personalRecords).length;
        return { todayWorkouts, weekWorkouts, monthVolume, totalPRs };
      };

      const stats = calculateStats();
      const startTimer = () => setIsTimerActive(true);
      const stopTimer = () => setIsTimerActive(false);
      const resetTimer = () => { setIsTimerActive(false); setTimerTime(0); };

      const renderDashboard = () => (
        <div>
          <div className="dashboard-stats">
            <div className="stat-card"><div className="stat-number">{stats.todayWorkouts}</div><div className="stat-label">ì˜¤ëŠ˜ ìš´ë™</div></div>
            <div className="stat-card"><div className="stat-number">{stats.weekWorkouts}</div><div className="stat-label">ì´ë²ˆ ì£¼ ìš´ë™</div></div>
            <div className="stat-card"><div className="stat-number">{(stats.monthVolume/1000).toFixed(1)}K</div><div className="stat-label">ì´ë²ˆ ë‹¬ ë³¼ë¥¨</div></div>
            <div className="stat-card"><div className="stat-number">{stats.totalPRs}</div><div className="stat-label">ê°œì¸ ê¸°ë¡</div></div>
          </div>
          <Timer isActive={isTimerActive} time={timerTime} onStart={startTimer} onStop={stopTimer} onReset={resetTimer} />
          <div className="chart-container">
            <div className="chart-title">ìµœê·¼ ìš´ë™ ê¸°ë¡</div>
            {workoutHistory.length === 0 ? (<div style={{ textAlign:'center', color:'#6c757d', padding:'20px' }}>ì•„ì§ ìš´ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>) : (workoutHistory.slice(0,5).map((workout, idx)=>(<div key={workout.id ?? idx} className="recent-workout"><div className="workout-date">{new Date(workout.date).toLocaleDateString('ko-KR')}</div><div className="workout-summary"><span><strong>{workout.name}</strong>{workout.setNumber && <span style={{ color:'#6c757d', marginLeft:8 }}>({workout.setNumber}/{workout.totalSets}ì„¸íŠ¸)</span>}</span><span>{workout.weight}kg Ã— {workout.reps}íšŒ</span></div></div>)))}
          </div>
        </div>
      );

      const renderWorkout = () => (
        <div>
          <ExerciseForm exercises={exercises} onAddExercise={addWorkoutRecord} personalRecords={personalRecords} />
          <div style={{ margin: '20px 0', textAlign: 'center' }}>
            <button className="btn btn-success" onClick={copyTodaysWorkoutToClipboard}>ğŸ“‹ ì˜¤ëŠ˜ ìš´ë™ ê¸°ë¡ ë³µì‚¬</button>
          </div>
          <div className="workout-sections">
            {bodyParts.map(part => (
              <div key={part} className={`workout-section ${part}`}>
                <div className="section-title">ğŸ“ {part}</div>
                {(exercises[part] || []).map((exercise, idx) => {
                  // [ìˆ˜ì •] ê° ìš´ë™ì˜ ê°€ì¥ ìµœê·¼ ê¸°ë¡ì„ ì°¾ìŒ
                  const lastRecord = workoutHistory.find(h => h.name === exercise.name);
                  return (
                    <div key={`${part}-${exercise.name}-${idx}`} className="simple-exercise-item">
                      <span className="exercise-name-simple">{exercise.name}</span>
                      {lastRecord ? (
                        <span className="last-record-info">
                          ìµœê·¼: {lastRecord.weight}kg Ã— {lastRecord.reps}íšŒ
                        </span>
                      ) : (
                        <span className="last-record-info" style={{ color: '#9ca3af' }}>
                          ê¸°ë¡ ì—†ìŒ
                        </span>
                      )}
                    </div>
                  );
                })}
              </div>
            ))}
          </div>
        </div>
      );

      const renderProgress = () => (
        <div>
          <div className="chart-container">
            <div className="chart-title">ê°œì¸ ê¸°ë¡ (PR)</div>
            {Object.keys(personalRecords).length === 0 ? (<div style={{ textAlign:'center', color:'#6c757d', padding:'20px' }}>ì•„ì§ ê°œì¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>) : (Object.entries(personalRecords).map(([name, record])=> (<div key={name} className="progress-item"><div className="progress-header"><span><strong>{name}</strong></span><span>{record.weight}kg Ã— {record.reps}íšŒ</span></div><div style={{ fontSize:'.9rem', color:'#6c757d' }}>1RM: {record.oneRM}kg | {new Date(record.date).toLocaleDateString('ko-KR')}</div></div>)))}
          </div>
          <div className="chart-container">
            <div className="chart-title">ë¶€ìœ„ë³„ ë³¼ë¥¨ ë¶„ì„</div>
            {bodyParts.map(part => {
              const vol = workoutHistory.filter(w=>w.bodyPart===part).reduce((t,w)=>t+(w.weight*w.reps*w.sets),0);
              const maxVol = Math.max(...bodyParts.map(bp => workoutHistory.filter(w=>w.bodyPart===bp).reduce((t,w)=>t+(w.weight*w.reps*w.sets),0)), 0);
              const pct = maxVol>0 ? (vol/maxVol)*100 : 0;
              return (<div key={part} className="progress-item"><div className="progress-header"><span>{part}</span><span>{vol.toLocaleString()}kg</span></div><div className="progress-bar"><div className="progress-fill" style={{ width:`${pct}%` }}></div></div></div>);
            })}
          </div>
          <div className="chart-container">
            <div className="chart-title">ìµœê·¼ ìš´ë™ íŠ¸ë Œë“œ</div>
            {workoutHistory.length === 0 ? (<div style={{ textAlign:'center', color:'#6c757d', padding:'20px' }}>ìš´ë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>) : (workoutHistory.slice(0,10).map((w) => (<div key={w.id} className="recent-workout"><div className="workout-date">{new Date(w.date).toLocaleDateString('ko-KR', { month:'short', day:'numeric', hour:'2-digit', minute:'2-digit' })}</div><div className="workout-summary"><span><strong>{w.name}</strong><span style={{ color:'#6c757d', marginLeft:8 }}>({w.bodyPart})</span>{w.setNumber && <span style={{ color:'#6c757d', marginLeft:8 }}>{w.setNumber}/{w.totalSets}ì„¸íŠ¸</span>}</span><span>{w.weight}kg Ã— {w.reps}íšŒ<span style={{ color:'#667eea', marginLeft:8 }}>= {(w.weight*w.reps*w.sets).toLocaleString()}kg</span></span></div>{w.notes && <div style={{ fontSize:'.9rem', color:'#6c757d', marginTop:5 }}>ğŸ“ {w.notes}</div>}</div>)))}
          </div>
        </div>
      );

      return (
        <div className="container">
          <div className="header">
            <h1>ğŸ’ª ìš´ë™ KPR ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>ì„¸íŠ¸ë³„ ê¸°ë¡ìœ¼ë¡œ ë” ì •í™•í•œ ìš´ë™ ê´€ë¦¬ë¥¼ ê²½í—˜í•˜ì„¸ìš”</p>
          </div>

          <div className="nav-tabs">
            <button className={`nav-tab ${activeTab==='dashboard' ? 'active' : ''}`} onClick={()=>setActiveTab('dashboard')}>ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button className={`nav-tab ${activeTab==='workout' ? 'active' : ''}`} onClick={()=>setActiveTab('workout')}>ğŸ‹ï¸ ìš´ë™ê¸°ë¡</button>
            <button className={`nav-tab ${activeTab==='progress' ? 'active' : ''}`} onClick={()=>setActiveTab('progress')}>ğŸ“ˆ ì§„ë„ì¶”ì </button>
            <button className={`nav-tab ${activeTab==='library' ? 'active' : ''}`} onClick={()=>setActiveTab('library')}>ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬</button>
            {/* [ì‚­ì œ] ì„¤ì • íƒ­ ë²„íŠ¼ */}
          </div>

          <div className="content-area">
            {activeTab==='dashboard' && renderDashboard()}
            {activeTab==='workout' && renderWorkout()}
            {activeTab==='progress' && renderProgress()}
            {activeTab==='library' && <Library bodyParts={Object.keys(exercises)} exercises={exercises} setExercises={setExercises} />}
            {/* [ì‚­ì œ] ì„¤ì • íƒ­ ë Œë”ë§ */}
          </div>
        </div>
      );
    };

    /* React 18 ë§ˆìš´íŠ¸ */
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WorkoutKPRApp />);
  </script>
</body>
</html>
