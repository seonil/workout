<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìš´ë™ KPR ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <!-- [ì‹ ê·œ] ìš´ë™ ì´ëª¨ì§€ íŒŒë¹„ì½˜ ì¶”ê°€ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‹ï¸</text></svg>">
  <!-- React 18 UMD + Babel (ê°œë°œìš©) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    .header { text-align:center; margin-bottom:30px; color:#fff; }
    .header h1 { font-size:2.5rem; margin-bottom:10px; text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    .header p { font-size:1.1rem; opacity:.9; }

    .nav-tabs { display:flex; background:#fff; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); overflow:hidden; flex-wrap:wrap; }
    .nav-tab { flex:1; padding:15px 10px; text-align:center; cursor:pointer; background:#fff; border:none; font-size:.9rem; font-weight:600; transition:all .3s ease; min-width:100px; }
    .nav-tab:hover { background:#f8f9fa; }
    .nav-tab.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }

    .content-area { background:#fff; border-radius:15px; padding:25px; box-shadow:0 8px 25px rgba(0,0,0,0.15); }

    .workout-sections { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:30px; }
    .workout-section { background:#f8f9fa; border-radius:12px; padding:20px; }
    .section-title { font-size:1.3rem; font-weight:bold; margin-bottom:15px; display:flex; align-items:center; gap:8px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; }

    /* ë¼ì´ë¸ŒëŸ¬ë¦¬ìš© ìŠ¤íƒ€ì¼ */
    .exercise-item { background:#fff; padding:12px 15px; margin-bottom:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); display: flex; justify-content: space-between; align-items: center; }
    .exercise-name { font-weight:600; color:#2c3e50; }
    
    /* ìš´ë™ ê¸°ë¡ í˜ì´ì§€ ëª©ë¡ ìŠ¤íƒ€ì¼ */
    .exercise-log-list { list-style: none; padding: 0; }
    .exercise-log-item { display: block; border-bottom: 1px solid #e9ecef; padding-bottom: 10px; margin-bottom: 10px; }
    .exercise-log-item:last-child { border-bottom: none; margin-bottom: 0; }
    .exercise-log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .exercise-name-log { font-weight: 600; color: #2c3e50; font-size: 0.95rem; }
    .last-session-date { font-size: 0.85rem; color: #6c757d; font-weight: 500; }
    .session-set-list { list-style: none; padding-left: 15px; font-size: 0.9rem; }
    .session-set-item { display: flex; justify-content: space-between; padding: 2px 0; }

    .dashboard-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
    .stat-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; padding:20px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .stat-number { font-size:2rem; font-weight:bold; margin-bottom:5px; }
    .stat-label { font-size:.9rem; opacity:.9; }

    .chart-container { background:#fff; padding:20px; border-radius:12px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .chart-title { font-size:1.2rem; font-weight:600; margin-bottom:20px; text-align:center; color:#2c3e50; }

    .workout-form { background:#f8f9fa; padding:20px; border-radius:12px; margin-bottom:20px; }
    .form-group { margin-bottom:15px; }
    .form-label { display:block; margin-bottom:5px; font-weight:600; color:#2c3e50; }
    .form-input, .form-select { width:100%; padding:10px 12px; border:2px solid #e9ecef; border-radius:8px; font-size:1rem; transition:border-color .3s ease; }
    .form-input:focus, .form-select:focus { outline:none; border-color:#667eea; }
    .form-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; }

    .btn { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:all .3s ease; }
    .btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
    .btn-secondary { background:#6c757d; color:#fff; }
    .btn-success { background:#28a745; color:#fff; }
    .btn-danger { background:#dc3545; color:#fff; }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.2); }

    .timer-display { font-size:3rem; font-weight:bold; text-align:center; margin:20px 0; color:#2c3e50; }
    .timer-controls { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }

    .progress-item { background:#fff; padding:15px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .progress-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    
    .sets-container { background:#fff; border-radius:12px; padding:20px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .set-row { display:grid; grid-template-columns:auto 1fr 1fr auto; gap:15px; align-items:center; padding:10px; margin-bottom:10px; background:#f8f9fa; border-radius:8px; }
    .set-number { font-weight:600; color:#667eea; }
    .set-input { padding:8px 12px; border:2px solid #e9ecef; border-radius:6px; font-size:1rem; width: 100%; }
    .set-input:focus { outline:none; border-color:#667eea; }
    .set-volume { font-size: .9rem; color: #6c757d; text-align: right; min-width: 70px; }
    .total-volume { text-align:center; padding:15px; background:#e8f4fd; border-radius:8px; margin-top:10px; font-weight:600; color:#0c5460; }
    .exercise-selection { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    
    .pr-display { text-align: center; padding: 10px; margin-bottom: 15px; background: #fef9c3; color: #713f12; border-radius: 8px; font-weight: 600; border: 1px solid #fde047; font-size: 0.9rem; }

    @media (max-width:768px) {
      .container { padding:10px; }
      /* [ìˆ˜ì •] ëª¨ë°”ì¼ íƒ­ ì •ë ¬ */
      .nav-tab { flex-grow: 1; min-width: 80px; font-size:.8rem; padding:12px 8px; }
      .workout-sections { grid-template-columns:1fr; }
      .form-row { grid-template-columns:1fr; }
      .header h1 { font-size:2rem; }
      .set-row { grid-template-columns: auto 1fr 1fr auto; gap: 8px; }
      .set-volume { min-width: 55px; }
      /* [ìˆ˜ì •] ëª¨ë°”ì¼ íƒ€ì´ë¨¸ í¬ê¸° ì¡°ì • */
      .timer-display { font-size: 2.5rem; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react,env">
    const { useState, useEffect, useRef } = React;

    const initialExercises = {
      'í•˜ì²´': ['ìŠ¤ì¿¼íŠ¸', 'ë ˆê·¸í”„ë ˆìŠ¤', 'ë ˆê·¸ìµìŠ¤í…ì…˜', 'ë ˆê·¸ì»¬', 'ìŠ¤í‹°í”„ë°ë“œ'],
      'ë“±': ['ë°”ë²¨ë¡œìš°', 'ë«í’€ë‹¤ìš´', 'íˆ¬ì•”ë¤ë²¨ë¡œìš°', 'ì›ì•”ë¤ë²¨ë¡œìš°', 'ì¼€ì´ë¸”ë¡œìš°', 'ì–´ì‹œìŠ¤íŠ¸í’€ì—…'],
      'ê°€ìŠ´': ['ë²¤ì¹˜í”„ë ˆìŠ¤', 'ë¤ë²¨ ë²¤ì¹˜í”„ë ˆìŠ¤', 'ì¸í´ë¼ì¸ë¤ë²¨í”„ë ˆìŠ¤', 'ì¸í´ë¼ì¸ìŠ¤ë¯¸ìŠ¤', 'ì¼€ì´ë¸” í¬ë¡œìŠ¤ì˜¤ë²„', 'í™ë± í”Œë¼ì´'],
      'ì–´ê¹¨': ['ì˜¤ë²„í—¤ë“œí”„ë ˆìŠ¤', 'í˜ì´ìŠ¤í’€', 'ì‚¬ì´ë“œ ë ˆí„°ëŸ´ ë ˆì´ì¦ˆ', 'ë²¤íŠ¸ ì˜¤ë²„ ë ˆì´ì¦ˆ', 'ë¦¬ì–´ ë¸íŠ¸ í”Œë¼ì´'],
      'íŒ”': ['ì¼€ì´ë¸”í‘¸ì‰¬ë‹¤ìš´', 'ë¤ë²¨ì»¬'],
      'ì½”ì–´': ['ë³µë¶€ì„œí‚·']
    };

    const useLocalStorage = (key, initialValue) => {
      const isBrowser = typeof window !== 'undefined' && typeof window.localStorage !== 'undefined';
      const [storedValue, setStoredValue] = useState(() => {
        if (!isBrowser) return initialValue;
        try { const item = window.localStorage.getItem(key); return item ? JSON.parse(item) : initialValue; }
        catch (error) { console.error('Error reading from localStorage:', error); return initialValue; }
      });
      const setValue = (value) => {
        try {
          const valueToStore = typeof value === 'function' ? value(storedValue) : value;
          setStoredValue(valueToStore);
          if (isBrowser) window.localStorage.setItem(key, JSON.stringify(valueToStore));
        } catch (error) { console.error('Error writing to localStorage:', error); }
      };
      return [storedValue, setValue];
    };

    const Timer = ({ isActive, time, onStart, onStop, onReset }) => {
      const formatTime = (seconds) => `${Math.floor(seconds / 60).toString().padStart(2,'0')}:${(seconds % 60).toString().padStart(2,'0')}`;
      return (
        <div className="chart-container" style={{ marginTop: 0, marginBottom: '20px' }}>
          <div className="chart-title">íœ´ì‹ íƒ€ì´ë¨¸</div>
          <div className="timer-display">{formatTime(time)}</div>
          <div className="timer-controls">
            <button className={`btn ${isActive ? 'btn-danger' : 'btn-success'}`} onClick={isActive ? onStop : onStart}>{isActive ? 'ì •ì§€' : 'ì‹œì‘'}</button>
            <button className="btn btn-secondary" onClick={onReset}>ë¦¬ì…‹</button>
          </div>
        </div>
      );
    };

    const ExerciseForm = ({ exercises, onAddSets, personalRecords }) => {
      const bodyParts = Object.keys(exercises);
      const [selectedBodyPart, setSelectedBodyPart] = useState(() => {
        try { const saved = localStorage.getItem('lastSelectedBodyPart'); return saved && bodyParts.includes(saved) ? saved : bodyParts[0] || 'í•˜ì²´'; } catch { return bodyParts[0] || 'í•˜ì²´'; }
      });
      const [selectedExercise, setSelectedExercise] = useState('');
      const [sets, setSets] = useState(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
      const [notes, setNotes] = useState('');
      const [currentPR, setCurrentPR] = useState(null);

      useEffect(() => { try { localStorage.setItem('lastSelectedBodyPart', selectedBodyPart); } catch {} }, [selectedBodyPart]);
      useEffect(() => { setSelectedExercise(''); resetSets(); }, [selectedBodyPart]);

      const resetSets = () => {
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
        setNotes('');
        setCurrentPR(null);
      };
      const handleExerciseChange = (e) => {
        const name = e.target.value;
        setSelectedExercise(name);
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
        setNotes('');
        setCurrentPR(name ? (personalRecords[name] || null) : null);
      };
      const updateSet = (index, field, value) => {
        const newSets = [...sets];
        newSets[index] = { ...newSets[index], [field]: value };
        setSets(newSets);
      };
      const calculateTotalVolume = () => sets.reduce((total, set) => (total + ((parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0))), 0);
      const getValidSets = () => sets.filter(set => (parseFloat(set.weight) || 0) > 0 && (parseInt(set.reps, 10) || 0) > 0);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!selectedBodyPart || !selectedExercise) { alert('ìš´ë™ ë¶€ìœ„ì™€ ìš´ë™ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
        const validSets = getValidSets();
        if (validSets.length === 0) { alert('ìµœì†Œ 1ì„¸íŠ¸ì˜ ë¬´ê²Œì™€ ë°˜ë³µìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        
        const sessionDate = new Date().toISOString();
        const newRecords = validSets.map((set, index) => ({
            id: Date.now() + index,
            name: selectedExercise,
            weight: parseFloat(set.weight),
            reps: parseInt(set.reps, 10),
            sets: 1,
            setNumber: index + 1,
            totalSets: validSets.length,
            notes: index === 0 ? notes : '',
            date: sessionDate,
            bodyPart: selectedBodyPart
        }));

        onAddSets(newRecords);

        const exerciseNameForAlert = selectedExercise;
        setSelectedExercise('');
        resetSets();
        alert(`${exerciseNameForAlert} ${validSets.length}ì„¸íŠ¸ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
      };

      const currentExerciseList = exercises[selectedBodyPart] || [];

      return (
        <div>
          <div className="exercise-selection">
            <div className="form-row">
              <div className="form-group">
                <label className="form-label">ë¶€ìœ„ ì„ íƒ</label>
                <select className="form-select" value={selectedBodyPart} onChange={(e) => setSelectedBodyPart(e.target.value)}>
                  {bodyParts.map((part) => <option key={part} value={part}>{part}</option>)}
                </select>
              </div>
              <div className="form-group">
                <label className="form-label">ìš´ë™ ì„ íƒ</label>
                <select className="form-select" value={selectedExercise} onChange={handleExerciseChange}>
                  <option value="">ìš´ë™ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  {currentExerciseList.map((exerciseName, index) => <option key={index} value={exerciseName}>{exerciseName}</option>)}
                </select>
              </div>
            </div>
          </div>
          {selectedExercise && (
            <div className="sets-container">
              <div className="chart-title">{selectedExercise} - ì„¸íŠ¸ë³„ ê¸°ë¡</div>
              {currentPR ? (<div className="pr-display">ğŸ† ê°œì¸ ìµœê³ ê¸°ë¡ (PR): {currentPR.weight}kg x {currentPR.reps}íšŒ ({new Date(currentPR.date).toLocaleDateString('ko-KR')})</div>) : (<div className="pr-display" style={{ background: '#f3f4f6', color: '#6b7280', border: '1px solid #e5e7eb' }}>ì•„ì§ ì´ ìš´ë™ì˜ ê°œì¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>)}
              {sets.map((set, index) => (
                <div key={index} className="set-row">
                  <div className="set-number">{index + 1}ì„¸íŠ¸</div>
                  <input type="number" className="set-input" placeholder="ë¬´ê²Œ (kg)" value={set.weight} onChange={(e) => updateSet(index, 'weight', e.target.value)} step="0.5" min="0" inputMode="decimal" />
                  <input type="number" className="set-input" placeholder="ë°˜ë³µìˆ˜" value={set.reps} onChange={(e) => updateSet(index, 'reps', e.target.value)} min="1" inputMode="numeric" />
                  <div className="set-volume">{(parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0)}kg</div>
                </div>
              ))}
              <div className="total-volume">ì´ ë³¼ë¥¨: {calculateTotalVolume().toLocaleString()}kg ({getValidSets().length}ì„¸íŠ¸)</div>
              <div className="form-group" style={{ marginTop: '15px' }}>
                <label className="form-label">ë©”ëª¨</label>
                <input type="text" className="form-input" value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="ìš´ë™ì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
              </div>
              <button type="button" className="btn btn-primary" style={{ width: '100%', marginTop: '15px' }} onClick={handleSubmit} disabled={getValidSets().length === 0}>
                {selectedExercise} ìš´ë™ ì™„ë£Œ ({getValidSets().length}ì„¸íŠ¸)
              </button>
            </div>
          )}
        </div>
      );
    };
    
    function Library({ bodyParts, exercises, setExercises }) {
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedBodyPart, setSelectedBodyPart] = useState('ì „ì²´');
      const [newExercise, setNewExercise] = useState({ name: '', bodyPart: 'í•˜ì²´' });
      const [isAddingExercise, setIsAddingExercise] = useState(false);

      const addNewExercise = () => {
        if (!newExercise.name.trim()) return;
        const newName = newExercise.name.trim();
        const part = newExercise.bodyPart;
        if ((exercises[part] || []).includes(newName)) { alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ìš´ë™ì…ë‹ˆë‹¤.'); return; }
        setExercises(prev => ({ ...prev, [part]: [...(prev[part] || []), newName].sort() }));
        setNewExercise({ name: '', bodyPart: part });
        setIsAddingExercise(false);
      };
      const deleteExercise = (bodyPart, exerciseName) => {
        if (window.confirm(`'${exerciseName}' ìš´ë™ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          setExercises(prev => ({ ...prev, [bodyPart]: (prev[bodyPart] || []).filter(name => name !== exerciseName) }));
        }
      };
      const filteredExercises = () => {
        const result = [];
        Object.entries(exercises).forEach(([part, list]) => {
          if (selectedBodyPart === 'ì „ì²´' || selectedBodyPart === part) {
            list.forEach(name => {
              if (name.toLowerCase().includes(searchTerm.toLowerCase())) result.push({ name, bodyPart: part });
            });
          }
        });
        return result;
      };

      return (
        <div>
          <div className="workout-form">
            <div className="form-group"><label className="form-label">ê²€ìƒ‰</label><input type="text" className="form-input" placeholder="ìš´ë™ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} /></div>
            <div className="form-group"><label className="form-label">ë¶€ìœ„ í•„í„°</label><select className="form-select" value={selectedBodyPart} onChange={(e)=>setSelectedBodyPart(e.target.value)}><option value="ì „ì²´">ì „ì²´</option>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div>
            <button className="btn btn-primary" onClick={()=>setIsAddingExercise(!isAddingExercise)} style={{ width:'100%' }}>{isAddingExercise ? 'ì·¨ì†Œ' : 'ìƒˆ ìš´ë™ ì¶”ê°€'}</button>
          </div>
          {isAddingExercise && (<div className="workout-form"><div className="form-group"><label className="form-label">ìš´ë™ ì´ë¦„</label><input type="text" className="form-input" value={newExercise.name} onChange={(e)=>setNewExercise(prev=>({...prev, name:e.target.value}))} placeholder="ìš´ë™ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" /></div><div className="form-group"><label className="form-label">ë¶€ìœ„</label><select className="form-select" value={newExercise.bodyPart} onChange={(e)=>setNewExercise(prev=>({...prev, bodyPart:e.target.value}))}>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div><button className="btn btn-success" onClick={addNewExercise} style={{ width:'100%' }}>ìš´ë™ ì¶”ê°€í•˜ê¸°</button></div>)}
          <div className="chart-container"><div className="chart-title">ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬ ({filteredExercises().length}ê°œ)</div><div style={{ maxHeight:'400px', overflowY:'auto' }}>{filteredExercises().map(({ name, bodyPart }) => (<div key={`${bodyPart}-${name}`} className="exercise-item"><span className="exercise-name">{name} <span style={{ background:'#e9ecef', color:'#6c757d', padding:'2px 8px', borderRadius:'12px', fontSize:'.8rem' }}>{bodyPart}</span></span><button className="btn btn-danger" style={{ padding:'4px 8px', fontSize:'.8rem' }} onClick={()=>deleteExercise(bodyPart, name)}>ì‚­ì œ</button></div>))}</div></div>
        </div>
      );
    }

    const WorkoutKPRApp = () => {
      const [activeTab, setActiveTab] = useState('workout');
      const [exercises, setExercises] = useLocalStorage('exercises', initialExercises);
      const [workoutHistory, setWorkoutHistory] = useLocalStorage('workoutHistory', []);
      const [personalRecords, setPersonalRecords] = useLocalStorage('personalRecords', {});
      const [timerTime, setTimerTime] = useState(0);
      const [isTimerActive, setIsTimerActive] = useState(false);
      const timerRef = useRef(null);

      const bodyParts = Object.keys(exercises);

      useEffect(() => {
        if (isTimerActive) {
          if (timerRef.current) clearInterval(timerRef.current);
          timerRef.current = setInterval(() => setTimerTime(prev => prev + 1), 1000);
        } else if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; }
        return () => { if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; } };
      }, [isTimerActive]);

      const calculateOneRM = (weight, reps) => {
        if (!Number.isFinite(weight) || !Number.isFinite(reps) || reps <= 0) return 0;
        if (reps === 1) return Math.round(weight);
        return Math.round(weight * (1 + reps / 30));
      };
      
      const addWorkoutSets = (records) => {
        setWorkoutHistory(prev => [...records, ...prev]);
        records.forEach(record => {
            const { name, weight, reps, date } = record;
            const currentPR = personalRecords[name];
            const newOneRM = calculateOneRM(weight, reps);
            if (!currentPR || newOneRM > currentPR.oneRM || (newOneRM === currentPR.oneRM && weight > currentPR.weight)) {
                setPersonalRecords(prev => ({ ...prev, [name]: { weight, reps, oneRM: newOneRM, date } }));
            }
        });
      };

      const copyTodaysWorkoutToClipboard = () => {
        const now = new Date();
        const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const todaysWorkouts = workoutHistory.filter(w => new Date(w.date) >= startOfToday).reverse();
        if (todaysWorkouts.length === 0) { alert('ì˜¤ëŠ˜ ê¸°ë¡ëœ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
        const groupedByExercise = todaysWorkouts.reduce((acc, workout) => {
            if (!acc[workout.name]) acc[workout.name] = [];
            acc[workout.name].push(workout);
            return acc;
        }, {});
        let clipboardText = `[${now.toLocaleDateString('ko-KR')} ìš´ë™ ê¸°ë¡]\n\n`;
        for (const exerciseName in groupedByExercise) {
            clipboardText += `ğŸ”¥ ${exerciseName}\n`;
            const sets = groupedByExercise[exerciseName];
            const mainNote = sets.find(s => s.notes)?.notes || '';
            sets.sort((a,b) => a.setNumber - b.setNumber).forEach(set => { clipboardText += `  - ${set.setNumber}ì„¸íŠ¸: ${set.weight}kg x ${set.reps}íšŒ\n`; });
            if (mainNote) clipboardText += `  ğŸ“ ë©”ëª¨: ${mainNote}\n`;
            clipboardText += '\n';
        }
        const textarea = document.createElement('textarea');
        textarea.value = clipboardText.trim();
        textarea.style.position = 'fixed'; textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try { document.execCommand('copy'); alert('ì˜¤ëŠ˜ì˜ ìš´ë™ ê¸°ë¡ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); }
        catch (err) { alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨: ', err); }
        document.body.removeChild(textarea);
      };

      const startTimer = () => setIsTimerActive(true);
      const stopTimer = () => setIsTimerActive(false);
      const resetTimer = () => { setIsTimerActive(false); setTimerTime(0); };

      const renderWorkout = () => (
        <div>
          <Timer isActive={isTimerActive} time={timerTime} onStart={startTimer} onStop={stopTimer} onReset={resetTimer} />
          <ExerciseForm exercises={exercises} onAddSets={addWorkoutSets} personalRecords={personalRecords} />
          <div style={{ margin: '20px 0', textAlign: 'center' }}>
            <button className="btn btn-success" onClick={copyTodaysWorkoutToClipboard}>ğŸ“‹ ì˜¤ëŠ˜ ìš´ë™ ê¸°ë¡ ë³µì‚¬</button>
          </div>
          <hr style={{ border: 'none', borderTop: '1px solid #e9ecef', margin: '30px 0' }}/>
          <div className="workout-sections">
            {bodyParts.map(part => (
              <div key={part} className="workout-section">
                <div className="section-title">{part}</div>
                <ul className="exercise-log-list">
                  {(exercises[part] || []).map(exerciseName => {
                    const exerciseRecords = workoutHistory.filter(h => h.name === exerciseName);
                    if (exerciseRecords.length === 0) return null;

                    const latestDateStr = new Date(Math.max(...exerciseRecords.map(r => new Date(r.date)))).toDateString();
                    const lastSessionRecords = exerciseRecords
                      .filter(r => new Date(r.date).toDateString() === latestDateStr)
                      .sort((a, b) => a.setNumber - b.setNumber);
                    
                    if (lastSessionRecords.length === 0) return null;

                    const maxWeightInSession = Math.max(...lastSessionRecords.map(r => r.weight));

                    return (
                      <li key={exerciseName} className="exercise-log-item">
                        <div className="exercise-log-header">
                          <span className="exercise-name-log">{exerciseName}</span>
                          <span className="last-session-date">{new Date(lastSessionRecords[0].date).toLocaleDateString('ko-KR')}</span>
                        </div>
                        <ul className="session-set-list">
                          {lastSessionRecords.map(set => (
                            <li key={set.id} className="session-set-item" style={{ fontWeight: set.weight === maxWeightInSession ? 'bold' : 'normal' }}>
                              <span>{set.setNumber}ì„¸íŠ¸</span>
                              <span>{set.weight}kg Ã— {set.reps}íšŒ</span>
                            </li>
                          ))}
                        </ul>
                      </li>
                    );
                  })}
                </ul>
              </div>
            ))}
          </div>
        </div>
      );

      const renderProgress = () => (
        <div>
          <div className="chart-container">
            <div className="chart-title">ê°œì¸ ê¸°ë¡ (PR) - KPR ê´€ë¦¬</div>
            {Object.keys(personalRecords).length === 0 ? (<div style={{ textAlign:'center', color:'#6c757d', padding:'20px' }}>ì•„ì§ ê°œì¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>) : (
              bodyParts.map(part => {
                const partPRs = Object.entries(personalRecords).filter(([name, record]) => (exercises[part] || []).includes(name));
                if (partPRs.length === 0) return null;
                return (
                  <div key={part} className="workout-section" style={{ marginBottom: '20px' }}>
                    <div className="section-title">{part}</div>
                    {partPRs.map(([name, record]) => (
                      <div key={name} className="progress-item">
                        <div className="progress-header">
                          <span><strong>{name}</strong></span>
                          <span>{record.weight}kg Ã— {record.reps}íšŒ</span>
                        </div>
                        <div style={{ fontSize:'.9rem', color:'#6c757d' }}>
                          ì¶”ì • 1RM: {record.oneRM}kg | ë‹¬ì„±: {new Date(record.date).toLocaleDateString('ko-KR')}
                        </div>
                      </div>
                    ))}
                  </div>
                )
              })
            )}
          </div>
        </div>
      );

      return (
        <div className="container">
          <div className="header">
            <h1>ìš´ë™ KPR ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
          </div>
          <div className="nav-tabs">
            <button className={`nav-tab ${activeTab==='workout' ? 'active' : ''}`} onClick={()=>setActiveTab('workout')}>ğŸ‹ï¸ ìš´ë™ê¸°ë¡</button>
            <button className={`nav-tab ${activeTab==='progress' ? 'active' : ''}`} onClick={()=>setActiveTab('progress')}>ğŸ“ˆ ì§„ë„ì¶”ì </button>
            <button className={`nav-tab ${activeTab==='library' ? 'active' : ''}`} onClick={()=>setActiveTab('library')}>ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬</button>
          </div>
          <div className="content-area">
            {activeTab==='workout' && renderWorkout()}
            {activeTab==='progress' && renderProgress()}
            {activeTab==='library' && <Library bodyParts={bodyParts} exercises={exercises} setExercises={setExercises} />}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WorkoutKPRApp />);
  </script>
</body>
</html>
