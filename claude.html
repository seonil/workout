<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>운동 KPR 관리 시스템</title>
  <!-- [신규] 운동 이모지 파비콘 추가 -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏋️</text></svg>">
  <!-- React 18 UMD + Babel (개발용) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
    .container { max-width:1200px; margin:0 auto; padding:20px; }
    .header { text-align:center; margin-bottom:30px; color:#fff; }
    .header h1 { font-size:2.5rem; margin-bottom:10px; text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    .header p { font-size:1.1rem; opacity:.9; }

    .nav-tabs { display:flex; background:#fff; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); overflow:hidden; flex-wrap:wrap; }
    .nav-tab { flex:1; padding:15px 10px; text-align:center; cursor:pointer; background:#fff; border:none; font-size:.9rem; font-weight:600; transition:all .3s ease; min-width:100px; }
    .nav-tab:hover { background:#f8f9fa; }
    .nav-tab.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }

    .content-area { background:#fff; border-radius:15px; padding:25px; box-shadow:0 8px 25px rgba(0,0,0,0.15); }

    .workout-sections { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-bottom:30px; }
    .workout-section { background:#f8f9fa; border-radius:12px; padding:20px; }
    .section-title { font-size:1.3rem; font-weight:bold; margin-bottom:15px; display:flex; align-items:center; gap:8px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; }

    /* 라이브러리용 스타일 */
    .exercise-item { background:#fff; padding:12px 15px; margin-bottom:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); display: flex; justify-content: space-between; align-items: center; }
    .exercise-name { font-weight:600; color:#2c3e50; }
    
    /* 운동 기록 페이지 목록 스타일 */
    .exercise-log-list { list-style: none; padding: 0; }
    .exercise-log-item { display: block; border-bottom: 1px solid #e9ecef; padding-bottom: 10px; margin-bottom: 10px; }
    .exercise-log-item:last-child { border-bottom: none; margin-bottom: 0; }
    .exercise-log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .exercise-name-log { font-weight: 600; color: #2c3e50; font-size: 0.95rem; }
    .last-session-date { font-size: 0.85rem; color: #6c757d; font-weight: 500; }
    .session-set-list { list-style: none; padding-left: 15px; font-size: 0.9rem; }
    .session-set-item { display: flex; justify-content: space-between; padding: 2px 0; }

    .dashboard-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
    .stat-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; padding:20px; border-radius:12px; text-align:center; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .stat-number { font-size:2rem; font-weight:bold; margin-bottom:5px; }
    .stat-label { font-size:.9rem; opacity:.9; }

    .chart-container { background:#fff; padding:20px; border-radius:12px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .chart-title { font-size:1.2rem; font-weight:600; margin-bottom:20px; text-align:center; color:#2c3e50; }

    .workout-form { background:#f8f9fa; padding:20px; border-radius:12px; margin-bottom:20px; }
    .form-group { margin-bottom:15px; }
    .form-label { display:block; margin-bottom:5px; font-weight:600; color:#2c3e50; }
    .form-input, .form-select { width:100%; padding:10px 12px; border:2px solid #e9ecef; border-radius:8px; font-size:1rem; transition:border-color .3s ease; }
    .form-input:focus, .form-select:focus { outline:none; border-color:#667eea; }
    .form-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px; }

    .btn { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:all .3s ease; }
    .btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
    .btn-secondary { background:#6c757d; color:#fff; }
    .btn-success { background:#28a745; color:#fff; }
    .btn-danger { background:#dc3545; color:#fff; }
    .btn:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.2); }

    .timer-display { font-size:3rem; font-weight:bold; text-align:center; margin:20px 0; color:#2c3e50; }
    .timer-controls { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }

    .progress-item { background:#fff; padding:15px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .progress-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    
    .sets-container { background:#fff; border-radius:12px; padding:20px; margin:20px 0; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    .set-row { display:grid; grid-template-columns:auto 1fr 1fr auto; gap:15px; align-items:center; padding:10px; margin-bottom:10px; background:#f8f9fa; border-radius:8px; }
    .set-number { font-weight:600; color:#667eea; }
    .set-input { padding:8px 12px; border:2px solid #e9ecef; border-radius:6px; font-size:1rem; width: 100%; }
    .set-input:focus { outline:none; border-color:#667eea; }
    .set-volume { font-size: .9rem; color: #6c757d; text-align: right; min-width: 70px; }
    .total-volume { text-align:center; padding:15px; background:#e8f4fd; border-radius:8px; margin-top:10px; font-weight:600; color:#0c5460; }
    .exercise-selection { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
    
    .pr-display { text-align: center; padding: 10px; margin-bottom: 15px; background: #fef9c3; color: #713f12; border-radius: 8px; font-weight: 600; border: 1px solid #fde047; font-size: 0.9rem; }

    @media (max-width:768px) {
      .container { padding:10px; }
      /* [수정] 모바일 탭 정렬 */
      .nav-tab { flex-grow: 1; min-width: 80px; font-size:.8rem; padding:12px 8px; }
      .workout-sections { grid-template-columns:1fr; }
      .form-row { grid-template-columns:1fr; }
      .header h1 { font-size:2rem; }
      .set-row { grid-template-columns: auto 1fr 1fr auto; gap: 8px; }
      .set-volume { min-width: 55px; }
      /* [수정] 모바일 타이머 크기 조정 */
      .timer-display { font-size: 2.5rem; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react,env">
    const { useState, useEffect, useRef } = React;

    const initialExercises = {
      '하체': ['스쿼트', '레그프레스', '레그익스텐션', '레그컬', '스티프데드'],
      '등': ['바벨로우', '랫풀다운', '투암덤벨로우', '원암덤벨로우', '케이블로우', '어시스트풀업'],
      '가슴': ['벤치프레스', '덤벨 벤치프레스', '인클라인덤벨프레스', '인클라인스미스', '케이블 크로스오버', '펙덱 플라이'],
      '어깨': ['오버헤드프레스', '페이스풀', '사이드 레터럴 레이즈', '벤트 오버 레이즈', '리어 델트 플라이'],
      '팔': ['케이블푸쉬다운', '덤벨컬'],
      '코어': ['복부서킷']
    };

    const useLocalStorage = (key, initialValue) => {
      const isBrowser = typeof window !== 'undefined' && typeof window.localStorage !== 'undefined';
      const [storedValue, setStoredValue] = useState(() => {
        if (!isBrowser) return initialValue;
        try { const item = window.localStorage.getItem(key); return item ? JSON.parse(item) : initialValue; }
        catch (error) { console.error('Error reading from localStorage:', error); return initialValue; }
      });
      const setValue = (value) => {
        try {
          const valueToStore = typeof value === 'function' ? value(storedValue) : value;
          setStoredValue(valueToStore);
          if (isBrowser) window.localStorage.setItem(key, JSON.stringify(valueToStore));
        } catch (error) { console.error('Error writing to localStorage:', error); }
      };
      return [storedValue, setValue];
    };

    const Timer = ({ isActive, time, onStart, onStop, onReset }) => {
      const formatTime = (seconds) => `${Math.floor(seconds / 60).toString().padStart(2,'0')}:${(seconds % 60).toString().padStart(2,'0')}`;
      return (
        <div className="chart-container" style={{ marginTop: 0, marginBottom: '20px' }}>
          <div className="chart-title">휴식 타이머</div>
          <div className="timer-display">{formatTime(time)}</div>
          <div className="timer-controls">
            <button className={`btn ${isActive ? 'btn-danger' : 'btn-success'}`} onClick={isActive ? onStop : onStart}>{isActive ? '정지' : '시작'}</button>
            <button className="btn btn-secondary" onClick={onReset}>리셋</button>
          </div>
        </div>
      );
    };

    const ExerciseForm = ({ exercises, onAddSets, personalRecords }) => {
      const bodyParts = Object.keys(exercises);
      const [selectedBodyPart, setSelectedBodyPart] = useState(() => {
        try { const saved = localStorage.getItem('lastSelectedBodyPart'); return saved && bodyParts.includes(saved) ? saved : bodyParts[0] || '하체'; } catch { return bodyParts[0] || '하체'; }
      });
      const [selectedExercise, setSelectedExercise] = useState('');
      const [sets, setSets] = useState(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
      const [notes, setNotes] = useState('');
      const [currentPR, setCurrentPR] = useState(null);

      useEffect(() => { try { localStorage.setItem('lastSelectedBodyPart', selectedBodyPart); } catch {} }, [selectedBodyPart]);
      useEffect(() => { setSelectedExercise(''); resetSets(); }, [selectedBodyPart]);

      const resetSets = () => {
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
        setNotes('');
        setCurrentPR(null);
      };
      const handleExerciseChange = (e) => {
        const name = e.target.value;
        setSelectedExercise(name);
        setSets(Array.from({ length: 5 }, () => ({ weight: '', reps: '' })));
        setNotes('');
        setCurrentPR(name ? (personalRecords[name] || null) : null);
      };
      const updateSet = (index, field, value) => {
        const newSets = [...sets];
        newSets[index] = { ...newSets[index], [field]: value };
        setSets(newSets);
      };
      const calculateTotalVolume = () => sets.reduce((total, set) => (total + ((parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0))), 0);
      const getValidSets = () => sets.filter(set => (parseFloat(set.weight) || 0) > 0 && (parseInt(set.reps, 10) || 0) > 0);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!selectedBodyPart || !selectedExercise) { alert('운동 부위와 운동을 선택하세요.'); return; }
        const validSets = getValidSets();
        if (validSets.length === 0) { alert('최소 1세트의 무게와 반복수를 입력해주세요.'); return; }
        
        const sessionDate = new Date().toISOString();
        const newRecords = validSets.map((set, index) => ({
            id: Date.now() + index,
            name: selectedExercise,
            weight: parseFloat(set.weight),
            reps: parseInt(set.reps, 10),
            sets: 1,
            setNumber: index + 1,
            totalSets: validSets.length,
            notes: index === 0 ? notes : '',
            date: sessionDate,
            bodyPart: selectedBodyPart
        }));

        onAddSets(newRecords);

        const exerciseNameForAlert = selectedExercise;
        setSelectedExercise('');
        resetSets();
        alert(`${exerciseNameForAlert} ${validSets.length}세트가 기록되었습니다!`);
      };

      const currentExerciseList = exercises[selectedBodyPart] || [];

      return (
        <div>
          <div className="exercise-selection">
            <div className="form-row">
              <div className="form-group">
                <label className="form-label">부위 선택</label>
                <select className="form-select" value={selectedBodyPart} onChange={(e) => setSelectedBodyPart(e.target.value)}>
                  {bodyParts.map((part) => <option key={part} value={part}>{part}</option>)}
                </select>
              </div>
              <div className="form-group">
                <label className="form-label">운동 선택</label>
                <select className="form-select" value={selectedExercise} onChange={handleExerciseChange}>
                  <option value="">운동을 선택하세요</option>
                  {currentExerciseList.map((exerciseName, index) => <option key={index} value={exerciseName}>{exerciseName}</option>)}
                </select>
              </div>
            </div>
          </div>
          {selectedExercise && (
            <div className="sets-container">
              <div className="chart-title">{selectedExercise} - 세트별 기록</div>
              {currentPR ? (<div className="pr-display">🏆 개인 최고기록 (PR): {currentPR.weight}kg x {currentPR.reps}회 ({new Date(currentPR.date).toLocaleDateString('ko-KR')})</div>) : (<div className="pr-display" style={{ background: '#f3f4f6', color: '#6b7280', border: '1px solid #e5e7eb' }}>아직 이 운동의 개인 기록이 없습니다.</div>)}
              {sets.map((set, index) => (
                <div key={index} className="set-row">
                  <div className="set-number">{index + 1}세트</div>
                  <input type="number" className="set-input" placeholder="무게 (kg)" value={set.weight} onChange={(e) => updateSet(index, 'weight', e.target.value)} step="0.5" min="0" inputMode="decimal" />
                  <input type="number" className="set-input" placeholder="반복수" value={set.reps} onChange={(e) => updateSet(index, 'reps', e.target.value)} min="1" inputMode="numeric" />
                  <div className="set-volume">{(parseFloat(set.weight) || 0) * (parseInt(set.reps, 10) || 0)}kg</div>
                </div>
              ))}
              <div className="total-volume">총 볼륨: {calculateTotalVolume().toLocaleString()}kg ({getValidSets().length}세트)</div>
              <div className="form-group" style={{ marginTop: '15px' }}>
                <label className="form-label">메모</label>
                <input type="text" className="form-input" value={notes} onChange={(e) => setNotes(e.target.value)} placeholder="운동에 대한 메모를 입력하세요" />
              </div>
              <button type="button" className="btn btn-primary" style={{ width: '100%', marginTop: '15px' }} onClick={handleSubmit} disabled={getValidSets().length === 0}>
                {selectedExercise} 운동 완료 ({getValidSets().length}세트)
              </button>
            </div>
          )}
        </div>
      );
    };
    
    function Library({ bodyParts, exercises, setExercises }) {
      const [searchTerm, setSearchTerm] = useState('');
      const [selectedBodyPart, setSelectedBodyPart] = useState('전체');
      const [newExercise, setNewExercise] = useState({ name: '', bodyPart: '하체' });
      const [isAddingExercise, setIsAddingExercise] = useState(false);

      const addNewExercise = () => {
        if (!newExercise.name.trim()) return;
        const newName = newExercise.name.trim();
        const part = newExercise.bodyPart;
        if ((exercises[part] || []).includes(newName)) { alert('이미 존재하는 운동입니다.'); return; }
        setExercises(prev => ({ ...prev, [part]: [...(prev[part] || []), newName].sort() }));
        setNewExercise({ name: '', bodyPart: part });
        setIsAddingExercise(false);
      };
      const deleteExercise = (bodyPart, exerciseName) => {
        if (window.confirm(`'${exerciseName}' 운동을 삭제하시겠습니까?`)) {
          setExercises(prev => ({ ...prev, [bodyPart]: (prev[bodyPart] || []).filter(name => name !== exerciseName) }));
        }
      };
      const filteredExercises = () => {
        const result = [];
        Object.entries(exercises).forEach(([part, list]) => {
          if (selectedBodyPart === '전체' || selectedBodyPart === part) {
            list.forEach(name => {
              if (name.toLowerCase().includes(searchTerm.toLowerCase())) result.push({ name, bodyPart: part });
            });
          }
        });
        return result;
      };

      return (
        <div>
          <div className="workout-form">
            <div className="form-group"><label className="form-label">검색</label><input type="text" className="form-input" placeholder="운동 이름으로 검색..." value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} /></div>
            <div className="form-group"><label className="form-label">부위 필터</label><select className="form-select" value={selectedBodyPart} onChange={(e)=>setSelectedBodyPart(e.target.value)}><option value="전체">전체</option>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div>
            <button className="btn btn-primary" onClick={()=>setIsAddingExercise(!isAddingExercise)} style={{ width:'100%' }}>{isAddingExercise ? '취소' : '새 운동 추가'}</button>
          </div>
          {isAddingExercise && (<div className="workout-form"><div className="form-group"><label className="form-label">운동 이름</label><input type="text" className="form-input" value={newExercise.name} onChange={(e)=>setNewExercise(prev=>({...prev, name:e.target.value}))} placeholder="운동 이름을 입력하세요" /></div><div className="form-group"><label className="form-label">부위</label><select className="form-select" value={newExercise.bodyPart} onChange={(e)=>setNewExercise(prev=>({...prev, bodyPart:e.target.value}))}>{bodyParts.map(part => <option key={part} value={part}>{part}</option>)}</select></div><button className="btn btn-success" onClick={addNewExercise} style={{ width:'100%' }}>운동 추가하기</button></div>)}
          <div className="chart-container"><div className="chart-title">운동 라이브러리 ({filteredExercises().length}개)</div><div style={{ maxHeight:'400px', overflowY:'auto' }}>{filteredExercises().map(({ name, bodyPart }) => (<div key={`${bodyPart}-${name}`} className="exercise-item"><span className="exercise-name">{name} <span style={{ background:'#e9ecef', color:'#6c757d', padding:'2px 8px', borderRadius:'12px', fontSize:'.8rem' }}>{bodyPart}</span></span><button className="btn btn-danger" style={{ padding:'4px 8px', fontSize:'.8rem' }} onClick={()=>deleteExercise(bodyPart, name)}>삭제</button></div>))}</div></div>
        </div>
      );
    }

    const WorkoutKPRApp = () => {
      const [activeTab, setActiveTab] = useState('workout');
      const [exercises, setExercises] = useLocalStorage('exercises', initialExercises);
      const [workoutHistory, setWorkoutHistory] = useLocalStorage('workoutHistory', []);
      const [personalRecords, setPersonalRecords] = useLocalStorage('personalRecords', {});
      const [timerTime, setTimerTime] = useState(0);
      const [isTimerActive, setIsTimerActive] = useState(false);
      const timerRef = useRef(null);

      const bodyParts = Object.keys(exercises);

      useEffect(() => {
        if (isTimerActive) {
          if (timerRef.current) clearInterval(timerRef.current);
          timerRef.current = setInterval(() => setTimerTime(prev => prev + 1), 1000);
        } else if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; }
        return () => { if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; } };
      }, [isTimerActive]);

      const calculateOneRM = (weight, reps) => {
        if (!Number.isFinite(weight) || !Number.isFinite(reps) || reps <= 0) return 0;
        if (reps === 1) return Math.round(weight);
        return Math.round(weight * (1 + reps / 30));
      };
      
      const addWorkoutSets = (records) => {
        setWorkoutHistory(prev => [...records, ...prev]);
        records.forEach(record => {
            const { name, weight, reps, date } = record;
            const currentPR = personalRecords[name];
            const newOneRM = calculateOneRM(weight, reps);
            if (!currentPR || newOneRM > currentPR.oneRM || (newOneRM === currentPR.oneRM && weight > currentPR.weight)) {
                setPersonalRecords(prev => ({ ...prev, [name]: { weight, reps, oneRM: newOneRM, date } }));
            }
        });
      };

      const copyTodaysWorkoutToClipboard = () => {
        const now = new Date();
        const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const todaysWorkouts = workoutHistory.filter(w => new Date(w.date) >= startOfToday).reverse();
        if (todaysWorkouts.length === 0) { alert('오늘 기록된 운동이 없습니다.'); return; }
        const groupedByExercise = todaysWorkouts.reduce((acc, workout) => {
            if (!acc[workout.name]) acc[workout.name] = [];
            acc[workout.name].push(workout);
            return acc;
        }, {});
        let clipboardText = `[${now.toLocaleDateString('ko-KR')} 운동 기록]\n\n`;
        for (const exerciseName in groupedByExercise) {
            clipboardText += `🔥 ${exerciseName}\n`;
            const sets = groupedByExercise[exerciseName];
            const mainNote = sets.find(s => s.notes)?.notes || '';
            sets.sort((a,b) => a.setNumber - b.setNumber).forEach(set => { clipboardText += `  - ${set.setNumber}세트: ${set.weight}kg x ${set.reps}회\n`; });
            if (mainNote) clipboardText += `  📝 메모: ${mainNote}\n`;
            clipboardText += '\n';
        }
        const textarea = document.createElement('textarea');
        textarea.value = clipboardText.trim();
        textarea.style.position = 'fixed'; textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try { document.execCommand('copy'); alert('오늘의 운동 기록이 클립보드에 복사되었습니다!'); }
        catch (err) { alert('복사에 실패했습니다.'); console.error('클립보드 복사 실패: ', err); }
        document.body.removeChild(textarea);
      };

      const startTimer = () => setIsTimerActive(true);
      const stopTimer = () => setIsTimerActive(false);
      const resetTimer = () => { setIsTimerActive(false); setTimerTime(0); };

      const renderWorkout = () => (
        <div>
          <Timer isActive={isTimerActive} time={timerTime} onStart={startTimer} onStop={stopTimer} onReset={resetTimer} />
          <ExerciseForm exercises={exercises} onAddSets={addWorkoutSets} personalRecords={personalRecords} />
          <div style={{ margin: '20px 0', textAlign: 'center' }}>
            <button className="btn btn-success" onClick={copyTodaysWorkoutToClipboard}>📋 오늘 운동 기록 복사</button>
          </div>
          <hr style={{ border: 'none', borderTop: '1px solid #e9ecef', margin: '30px 0' }}/>
          <div className="workout-sections">
            {bodyParts.map(part => (
              <div key={part} className="workout-section">
                <div className="section-title">{part}</div>
                <ul className="exercise-log-list">
                  {(exercises[part] || []).map(exerciseName => {
                    const exerciseRecords = workoutHistory.filter(h => h.name === exerciseName);
                    if (exerciseRecords.length === 0) return null;

                    const latestDateStr = new Date(Math.max(...exerciseRecords.map(r => new Date(r.date)))).toDateString();
                    const lastSessionRecords = exerciseRecords
                      .filter(r => new Date(r.date).toDateString() === latestDateStr)
                      .sort((a, b) => a.setNumber - b.setNumber);
                    
                    if (lastSessionRecords.length === 0) return null;

                    const maxWeightInSession = Math.max(...lastSessionRecords.map(r => r.weight));

                    return (
                      <li key={exerciseName} className="exercise-log-item">
                        <div className="exercise-log-header">
                          <span className="exercise-name-log">{exerciseName}</span>
                          <span className="last-session-date">{new Date(lastSessionRecords[0].date).toLocaleDateString('ko-KR')}</span>
                        </div>
                        <ul className="session-set-list">
                          {lastSessionRecords.map(set => (
                            <li key={set.id} className="session-set-item" style={{ fontWeight: set.weight === maxWeightInSession ? 'bold' : 'normal' }}>
                              <span>{set.setNumber}세트</span>
                              <span>{set.weight}kg × {set.reps}회</span>
                            </li>
                          ))}
                        </ul>
                      </li>
                    );
                  })}
                </ul>
              </div>
            ))}
          </div>
        </div>
      );

      const renderProgress = () => (
        <div>
          <div className="chart-container">
            <div className="chart-title">개인 기록 (PR) - KPR 관리</div>
            {Object.keys(personalRecords).length === 0 ? (<div style={{ textAlign:'center', color:'#6c757d', padding:'20px' }}>아직 개인 기록이 없습니다.</div>) : (
              bodyParts.map(part => {
                const partPRs = Object.entries(personalRecords).filter(([name, record]) => (exercises[part] || []).includes(name));
                if (partPRs.length === 0) return null;
                return (
                  <div key={part} className="workout-section" style={{ marginBottom: '20px' }}>
                    <div className="section-title">{part}</div>
                    {partPRs.map(([name, record]) => (
                      <div key={name} className="progress-item">
                        <div className="progress-header">
                          <span><strong>{name}</strong></span>
                          <span>{record.weight}kg × {record.reps}회</span>
                        </div>
                        <div style={{ fontSize:'.9rem', color:'#6c757d' }}>
                          추정 1RM: {record.oneRM}kg | 달성: {new Date(record.date).toLocaleDateString('ko-KR')}
                        </div>
                      </div>
                    ))}
                  </div>
                )
              })
            )}
          </div>
        </div>
      );

      return (
        <div className="container">
          <div className="header">
            <h1>운동 KPR 관리 시스템</h1>
          </div>
          <div className="nav-tabs">
            <button className={`nav-tab ${activeTab==='workout' ? 'active' : ''}`} onClick={()=>setActiveTab('workout')}>🏋️ 운동기록</button>
            <button className={`nav-tab ${activeTab==='progress' ? 'active' : ''}`} onClick={()=>setActiveTab('progress')}>📈 진도추적</button>
            <button className={`nav-tab ${activeTab==='library' ? 'active' : ''}`} onClick={()=>setActiveTab('library')}>📚 라이브러리</button>
          </div>
          <div className="content-area">
            {activeTab==='workout' && renderWorkout()}
            {activeTab==='progress' && renderProgress()}
            {activeTab==='library' && <Library bodyParts={bodyParts} exercises={exercises} setExercises={setExercises} />}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WorkoutKPRApp />);
  </script>
</body>
</html>
